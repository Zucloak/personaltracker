/* --- Global & Root Variables --- */
:root {
    --font-title: 'MedievalSharp', cursive; /* Or 'Cinzel Decorative' */
    --font-content: 'Open Sans', sans-serif;

    /* Default Dark Theme - Base (can be overridden by JS themes) */
    --bg-dark: #0c0a09; /* Even darker, almost black-brown */
    --bg-section: #1f1b18; /* Dark stone/leather brown for panels */
    --bg-element: #2e2823; /* Lighter for cards, inputs */
    --bg-header: rgba(12, 10, 9, 0.88); /* Header bg with glassmorphism */
    --bg-modal: #181412; /* Darker for modal content */

    --text-light: #f5eade; /* Warmer off-white */
    --text-medium: #c0b0a0; /* Muted light brown */
    --text-darker: #8a7868; /* For less important text */
    --text-title: var(--color-gold);
    --text-on-gold: #4a3000; /* Dark brown for text on gold buttons */

    --color-gold: #FFD700;
    --color-gold-darker: #c08e0e; /* More saturated dark gold */
    --color-gold-faded: #a08030;
    --color-yellow-bright: #FFEE77; /* Softer bright yellow */
    --color-red-primary: #d32f2f; /* Richer red */
    --color-red-accent: #9a0000; /* Deeper dark red */
    --color-green-complete: #4caf50; /* Brighter, positive green */
    --color-blue-accent: #42a5f5; /* For Pomodoro or specific highlights */

    --border-color: #6a5848; /* More pronounced brown border */
    --border-accent: var(--color-gold);
    --border-panel: 2px solid var(--color-gold-darker);
    --border-panel-inner: 1px dashed var(--color-gold-faded);

    --xp-bar-bg: linear-gradient(90deg, var(--color-yellow-bright), var(--color-gold));
    --xp-bar-container-bg: #403020; /* Darker, richer brown for XP bar container */

    --button-primary-bg: var(--color-red-primary);
    --button-primary-border: var(--color-red-accent);
    --button-primary-hover-bg: var(--color-red-accent);
    --button-primary-hover-border: var(--color-red-primary);
    --button-add-bg: var(--color-gold);
    --button-add-text: var(--text-on-gold);
    --button-add-border: var(--color-gold-darker);
    --button-add-hover-bg: var(--color-yellow-bright);
    --button-add-hover-border: var(--color-gold);

    --border-radius-main: 10px; /* Softer, modern radius */
    --border-radius-small: 6px;
    --box-shadow-strong: 0px 8px 20px rgba(0, 0, 0, 0.65);
    --box-shadow-subtle: 0px 4px 10px rgba(0, 0, 0, 0.45);
    --box-shadow-inset: inset 0px 0px 12px rgba(0,0,0,0.7);
    --box-shadow-text: 1px 1px 3px rgba(0,0,0,0.8);

    --backdrop-filter-glass: blur(10px) saturate(160%) brightness(0.9);
    --header-height: 75px;
    --nav-link-glow: 0 0 10px var(--color-gold);
    --transition-main: 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); /* Standard transition */
}

/* --- Basic Reset & Body --- */
* { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; font-size: 16px; /* Base font size */ }

body {
    font-family: var(--font-content);
    background-color: var(--bg-dark);
    color: var(--text-light);
    line-height: 1.75;
    padding-top: var(--header-height);
    transition: background-color 0.5s ease, color 0.5s ease;
    /* Example: Subtle parchment texture for the body background */
    /* background-image: url('https://www.transparenttextures.com/patterns/argyle.png'); */ /* REPLACE */
    /* background-blend-mode: multiply; */
}

.container {
    width: 92%; /* Slightly more width */
    max-width: 1280px; /* Wider max for larger screens */
    margin: 0 auto;
    padding: 30px 15px;
}

/* --- Typography --- */
h1, h2, h3, h4 {
    font-family: var(--font-title);
    color: var(--text-title);
    margin-bottom: 0.65em;
    letter-spacing: 1.3px;
    text-shadow: var(--box-shadow-text);
    line-height: 1.3; /* Better line height for titles */
}
.site-title {
    font-family: 'Cinzel Decorative', var(--font-title); /* Prioritize a more elaborate font */
    font-size: clamp(1.9em, 4.5vw, 2.8em);
    color: var(--color-gold);
    margin: 0; display: flex; align-items: center; gap: 12px;
}
.site-logo-icon { height: clamp(28px, 5.5vw, 40px); width: auto; filter: drop-shadow(0 0 5px var(--color-gold)); }

.section-title.ornate-title {
    font-size: clamp(2em, 5.5vw, 2.8em);
    text-align: center;
    padding-bottom: 18px;
    margin-bottom: 40px;
    position: relative;
    color: var(--text-title);
}
.section-title.ornate-title span {
    background: var(--bg-section); /* Needs to match parent panel */
    padding: 0 25px;
    position: relative; z-index: 1;
}
.section-title.ornate-title::before, .section-title.ornate-title::after {
    content: ''; position: absolute; left: 5%; right: 5%; /* Don't go full width */
    height: 2px; background-image: linear-gradient(to right, transparent, var(--color-gold-darker), transparent); /* Faded ends */
    z-index: 0;
}
.section-title.ornate-title::before { top: 50%; transform: translateY(-4px); }
.section-title.ornate-title::after { top: 50%; transform: translateY(4px); height: 1px; background-image: linear-gradient(to right, transparent, var(--color-gold-faded), transparent); }

.subsection-title {
    font-size: clamp(1.3em, 3.5vw, 1.7em);
    color: var(--color-yellow-bright);
    border-bottom: 1px solid var(--color-gold-faded);
    padding-bottom: 8px;
    margin-top: 25px;
    margin-bottom: 20px;
    display: flex; align-items: center; gap: 10px;
}
.subsection-title .permanent-icon { width: 20px; height: 20px; opacity: 0.8; }

.modal-title { font-size: clamp(1.6em, 4.5vw, 2.1em); color: var(--color-gold); }
p { margin-bottom: 1.3em; color: var(--text-medium); font-size: clamp(0.95rem, 2.6vw, 1.05rem); }
.gold-text { color: var(--color-gold); font-weight: bold; text-shadow: 0 0 3px var(--color-gold); }
.inline-icon { width: 1em; height: 1em; vertical-align: -0.15em; margin-left: 0.3em; opacity: 0.9; }

/* --- Header & Navigation --- */
.main-header {
    background-color: var(--bg-header);
    -webkit-backdrop-filter: var(--backdrop-filter-glass); backdrop-filter: var(--backdrop-filter-glass);
    position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
    border-bottom: 3px solid var(--color-gold-darker); /* More prominent border */
    box-shadow: var(--box-shadow-strong); transition: background-color 0.5s ease, border-color 0.5s ease;
    height: var(--header-height);
}
.header-content {
    display: flex; justify-content: space-between; align-items: center;
    padding: 0 clamp(15px, 3vw, 30px); height: 100%; max-width: 1400px; margin: 0 auto; /* Wider content area */
}
.player-stats-header { display: flex; align-items: center; gap: clamp(10px, 2.5vw, 20px); font-family: var(--font-content); font-size: clamp(0.9em, 2.5vw, 1.05em); color: var(--text-medium); }
.stat-item {
    display: flex; align-items: center; gap: 8px; color: var(--color-gold);
    background-color: rgba(0,0,0,0.25); padding: 6px 12px; border-radius: var(--border-radius-small);
    border: 1px solid var(--color-gold-faded); text-shadow: 0 0 3px var(--color-gold);
}
.stat-icon { width: clamp(18px, 4vw, 22px); height: clamp(18px, 4vw, 22px); filter: drop-shadow(0 0 4px var(--color-gold)); }

.sound-toggle-btn {
    background: transparent; border: 1px solid var(--color-gold-faded);
    padding: 8px; border-radius: 50%; line-height: 0; margin-left: 10px;
}
.sound-toggle-btn:hover { background-color: rgba(255,215,0,0.1); border-color: var(--color-gold); }
.sound-toggle-btn .button-icon { width: 20px; height: 20px; filter: invert(86%) sepia(60%) saturate(380%) hue-rotate(324deg) brightness(104%) contrast(97%); } /* Gold tint for icon */
.sound-toggle-btn.sound-off .button-icon { filter: grayscale(100%) opacity(0.7); }

.top-nav {
    display: flex; justify-content: center; align-items: center;
    background-color: rgba(12, 10, 9, 0.75); /* Slightly different transparency from header */
    -webkit-backdrop-filter: var(--backdrop-filter-glass); backdrop-filter: var(--backdrop-filter-glass);
    padding: 10px 0; box-shadow: 0 3px 8px rgba(0,0,0,0.35);
    border-top: 1px solid var(--color-gold-darker); /* Separator line */
}
.nav-link {
    font-family: var(--font-title); color: var(--color-yellow-bright); text-decoration: none;
    margin: 0 clamp(10px, 2.2vw, 18px); font-size: clamp(1.05em, 3vw, 1.3em);
    padding: 10px 15px; border-radius: var(--border-radius-small);
    transition: color var(--transition-main), text-shadow var(--transition-main), transform var(--transition-main);
    position: relative;
}
.nav-link::after {
    content: ''; position: absolute; bottom: 4px; left: 50%; width: 0; height: 2.5px;
    background-color: var(--color-gold); transition: width 0.3s ease, left 0.3s ease;
    box-shadow: var(--nav-link-glow); border-radius: 2px;
}
.nav-link:hover, .nav-link.active-nav-link {
    color: var(--color-gold); text-shadow: var(--nav-link-glow); transform: translateY(-2px);
}
.nav-link:hover::after, .nav-link.active-nav-link::after { width: 70%; left: 15%; }

.nav-toggle-btn { display: none; /* Logic handled by media queries */ background: transparent; border: none; cursor: pointer; padding: 10px; z-index: 1001; }
.nav-toggle-btn span { display: block; width: 28px; height: 3.5px; background-color: var(--color-gold); margin: 5px 0; border-radius: 3px; transition: all 0.3s ease-in-out; }
.nav-toggle-btn.active span:nth-child(1) { transform: translateY(8.5px) rotate(45deg); }
.nav-toggle-btn.active span:nth-child(2) { opacity: 0; }
.nav-toggle-btn.active span:nth-child(3) { transform: translateY(-8.5px) rotate(-45deg); }

/* --- Content Sections (Panel Style) --- */
.content-section.panel-style {
    background-color: var(--bg-section);
    padding: clamp(25px, 4.5vw, 40px);
    margin-bottom: 40px;
    border-radius: var(--border-radius-main);
    border: var(--border-panel);
    box-shadow: var(--box-shadow-strong), var(--box-shadow-inset);
    position: relative; transition: background-color 0.5s ease, border-color 0.5s ease;
    overflow: hidden; /* For decorative elements */
}
/* Ornate corners for panels */
.content-section.panel-style::before, .content-section.panel-style::after {
    content: ''; position: absolute; width: 25px; height: 25px; /* Size of corner elements */
    background-image: url('https://cdn-icons-png.flaticon.com/512/5739/5739178.png'); /* Example Ornate Corner - REPLACE */
    background-size: contain; background-repeat: no-repeat;
    opacity: 0.5; filter: invert(86%) sepia(60%) saturate(380%) hue-rotate(324deg) brightness(104%) contrast(97%); /* Gold tint */
}
.content-section.panel-style::before { top: 8px; left: 8px; } /* Top-left */
.content-section.panel-style::after { bottom: 8px; right: 8px; transform: rotate(180deg); } /* Bottom-right */

.section-actions { text-align: center; margin-bottom: 30px; }

/* --- Buttons (General) --- */
.action-button {
    font-family: var(--font-title); padding: 12px 24px; font-size: clamp(1.05em, 2.6vw, 1.2em);
    letter-spacing: 1px; border-radius: var(--border-radius-small); cursor: pointer;
    transition: all var(--transition-main); text-transform: uppercase;
    box-shadow: 0 3px 6px rgba(0,0,0,0.35), inset 0 -3px 2px rgba(0,0,0,0.25);
    border-width: 2px; border-style: solid; display: inline-flex; align-items: center; gap: 10px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
}
.action-button:hover { transform: translateY(-3px) scale(1.03); box-shadow: 0 5px 12px rgba(0,0,0,0.45), inset 0 -2px 1px rgba(0,0,0,0.15); }
.action-button:active { transform: translateY(0px) scale(0.97); box-shadow: 0 2px 4px rgba(0,0,0,0.3), inset 0 -1px 0px rgba(0,0,0,0.1); }
.button-icon { width: clamp(18px, 3.2vw, 20px); height: clamp(18px, 3.2vw, 20px); }
.action-button.add-button .button-icon { filter: brightness(0.6) contrast(1.2); } /* For dark icon on gold button */

.action-button.complete-button, .action-button.track-button { background-color: var(--button-primary-bg); border-color: var(--button-primary-border); color: var(--text-light); }
.action-button.complete-button:hover, .action-button.track-button:hover { background-color: var(--button-primary-hover-bg); border-color: var(--button-primary-hover-border); }
.action-button.add-button { background-color: var(--button-add-bg); color: var(--button-add-text); border-color: var(--button-add-border); }
.action-button.add-button:hover { background-color: var(--button-add-hover-bg); border-color: var(--button-add-hover-border); }
.action-button.reset-button { background-color: #5a4838; color: var(--text-medium); border-color: #3e3226; }
.action-button.reset-button:hover { background-color: #3e3226; border-color: #2a211a; }


/* --- Character Sheet --- */
.character-sheet-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; }
.char-stats-panel, .char-theme-panel, .char-recent-achievements { background-color: var(--bg-element); padding: 20px; border-radius: var(--border-radius-main); border: 1px solid var(--border-color); box-shadow: var(--box-shadow-subtle); }
.char-stats-panel p, .char-theme-panel p { margin-bottom: 0.8em; font-size: 1.05em; display: flex; align-items: center; justify-content: space-between; }
.char-stat-value { color: var(--text-light); font-weight: bold; }
.small-xp-bar { max-width: 100%; height: 20px !important; margin: 5px 0 10px; }
.small-xp-bar .xp-bar { border-radius: 18px; }
.theme-preview.large-preview { height: 180px; margin-bottom: 15px; background-color: var(--bg-dark); border: 2px solid var(--border-accent); }
#char-recent-feats-list { list-style: none; padding: 0; }
#char-recent-feats-list li { padding: 8px 0; border-bottom: 1px dashed var(--border-color); font-size: 0.95em; }
#char-recent-feats-list li:last-child { border-bottom: none; }

/* --- Quests & Side Quests --- */
.quest-list { display: grid; gap: 25px; }
.quest-item {
    background-color: var(--bg-element); padding: 20px 25px; border-radius: var(--border-radius-main);
    border-left: 8px solid var(--color-gold); display: flex; justify-content: space-between;
    align-items: center; flex-wrap: wrap; gap: 15px; transition: all var(--transition-main);
    box-shadow: var(--box-shadow-subtle);
}
.quest-item:hover { transform: scale(1.02); box-shadow: 0 0 20px color-mix(in srgb, var(--color-gold) 35%, transparent); z-index: 5; /* Bring to front */ }
.quest-item.priority-quest { border-left-color: var(--color-red-primary); box-shadow: inset 4px 0 0 var(--color-red-primary), var(--box-shadow-subtle); }
.quest-item.priority-quest:hover { box-shadow: 0 0 20px color-mix(in srgb, var(--color-red-primary) 35%, transparent), inset 4px 0 0 var(--color-red-primary); }
.quest-item.completed-quest { opacity: 0.7; border-left-color: var(--color-green-complete); background-color: color-mix(in srgb, var(--bg-element) 50%, #000); }
.quest-item.completed-quest .quest-name { text-decoration: line-through; color: var(--text-darker); }
.quest-item.completed-quest .action-button { background-color: var(--color-green-complete); border-color: darken(var(--color-green-complete), 20%); opacity: 0.9; }
.quest-details { flex-grow: 1; padding-right: 20px; }
.quest-name { font-size: clamp(1.15em, 3.2vw, 1.4em); color: var(--color-yellow-bright); margin-bottom: 6px; }
.quest-desc { font-size: clamp(0.9em, 2.3vw, 1em); color: var(--text-medium); margin-bottom: 10px; }
.quest-reward { font-size: clamp(0.85em, 2.1vw, 0.95em); font-style: italic; color: var(--text-darker); }

.predefined-side-quests { margin-bottom: 30px; }
.side-quest-suggestion-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
.side-quest-suggestion-item {
    background-color: var(--bg-element); padding: 15px; border-radius: var(--border-radius-small);
    border: 1px solid var(--border-color); text-align: center;
}
.side-quest-suggestion-item h4 { font-size: 1.1em; color: var(--text-light); margin-bottom: 8px; }
.side-quest-suggestion-item p { font-size: 0.85em; color: var(--text-darker); margin-bottom: 10px; }
.side-quest-suggestion-item .action-button { width: 100%; font-size: 0.9em; padding: 8px 10px; }


/* --- Habit Inventory --- */
.habit-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 28px; }
.habit-card {
    background-color: var(--bg-element); padding: 25px; border-radius: var(--border-radius-main);
    text-align: center; border: 1px solid var(--border-color); box-shadow: var(--box-shadow-subtle);
    transition: all var(--transition-main); display: flex; flex-direction: column; justify-content: space-between;
    position: relative;
}
.habit-card::before, .habit-card::after { /* Decorative corners from parent */
    content: ''; position: absolute; width: 12px; height: 12px;
    border-color: var(--color-gold-faded); border-style: solid; opacity: 0.5; transition: opacity var(--transition-main);
}
.habit-card::before { top: -4px; left: -4px; border-width: 2.5px 0 0 2.5px; border-top-left-radius: var(--border-radius-main); }
.habit-card::after { bottom: -4px; right: -4px; border-width: 0 2.5px 2.5px 0; border-bottom-right-radius: var(--border-radius-main); }
.habit-card:hover { transform: translateY(-8px) scale(1.04); border-color: var(--color-yellow-bright); box-shadow: 0 0 22px color-mix(in srgb, var(--color-yellow-bright) 25%, transparent); z-index: 5; }
.habit-card:hover::before, .habit-card:hover::after { opacity: 0.9; }
.habit-item-icon { width: clamp(55px, 11vw, 70px); height: clamp(55px, 11vw, 70px); margin: 0 auto 18px auto; object-fit: contain; filter: drop-shadow(0px 0px 6px var(--color-gold)); transition: transform 0.3s ease; }
.habit-card:hover .habit-item-icon { transform: scale(1.12) rotate(5deg); }
.habit-title { font-size: clamp(1.1em, 3.2vw, 1.3em); color: var(--color-yellow-bright); margin-bottom: 12px; word-wrap: break-word; }
.item-progress-bar-container { background-color: #5a4838; border-radius: var(--border-radius-small); height: 16px; margin-bottom: 12px; overflow: hidden; border: 1px solid var(--border-color); }
.item-progress-bar { background: linear-gradient(to right, var(--color-red-accent), var(--color-red-primary)); height: 100%; border-radius: var(--border-radius-small); transition: width 0.5s ease-in-out, background 0.5s ease; }
.habit-card .item-progress-bar.completed { background: linear-gradient(to right, var(--color-gold-darker), var(--color-gold)); }
.habit-status, .habit-target-display { font-size: clamp(0.85em, 2.1vw, 0.95em); color: var(--text-darker); margin-top: 6px; }
.habit-card .action-button.track-button { margin-top: 18px; width: 100%; }
.habit-card .action-button.track-button.maxed-out { background-color: var(--color-green-complete); color: var(--text-light); border-color: darken(var(--color-green-complete),15%); }

/* --- Captain's Log (Journal & Mood) --- */
.log-entry-area { margin-bottom: 30px; }
#current-log-date { color: var(--text-light); }
.mood-selector { margin: 15px 0; text-align: center; }
.mood-selector p { margin-bottom: 10px; color: var(--text-medium); }
.mood-btn {
    background: var(--bg-element); border: 2px solid var(--border-color); border-radius: 50%;
    width: 50px; height: 50px; margin: 0 5px; cursor: pointer; transition: all var(--transition-main); padding: 0;
}
.mood-btn img { width: 60%; height: 60%; object-fit: contain; opacity: 0.7; transition: opacity var(--transition-main); }
.mood-btn:hover img, .mood-btn.selected img { opacity: 1; }
.mood-btn:hover { border-color: var(--color-gold); transform: scale(1.1); }
.mood-btn.selected { border-color: var(--color-gold); box-shadow: 0 0 10px var(--color-gold); }
#selected-mood-display { color: var(--color-yellow-bright); font-weight: bold; }
#journal-entry {
    width: 100%; min-height: 150px; background-color: var(--bg-element); color: var(--text-light);
    border: 1px solid var(--border-color); border-radius: var(--border-radius-small); padding: 15px;
    font-family: var(--font-content); font-size: 1em; margin-bottom: 15px; resize: vertical;
}
#journal-entry:focus { border-color: var(--color-gold); box-shadow: 0 0 8px color-mix(in srgb, var(--color-gold) 30%, transparent); outline: none; }
.past-logs-area #past-log-dates-dropdown {
    display: block; width: 100%; max-width: 300px; padding: 10px; margin-bottom: 15px;
    background-color: var(--bg-element); color: var(--text-light); border: 1px solid var(--border-color);
    border-radius: var(--border-radius-small); font-family: var(--font-content);
}
.past-log-content {
    background-color: var(--bg-element); padding: 15px; border-radius: var(--border-radius-small);
    border: 1px solid var(--border-color); min-height: 100px; color: var(--text-medium);
}
.past-log-content .mood { font-weight: bold; color: var(--color-yellow-bright); margin-bottom: 5px; }
.past-log-content .entry { white-space: pre-wrap; } /* Preserve line breaks */


/* --- Pomodoro Timer --- */
.pomodoro-timer { text-align: center; background-color: var(--bg-element); padding: 25px; border-radius: var(--border-radius-main); border: 1px solid var(--border-color); }
.timer-display { font-family: var(--font-title); font-size: clamp(3em, 10vw, 5em); color: var(--color-blue-accent); margin-bottom: 10px; text-shadow: 0 0 10px var(--color-blue-accent); }
.timer-status { font-size: 1.1em; color: var(--text-medium); margin-bottom: 20px; font-style: italic; }
.pomodoro-controls { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
.pomodoro-controls .action-button { padding: 10px 15px; font-size: 1em; }
.pomodoro-settings { display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
.pomodoro-settings label { color: var(--text-medium); }
.pomodoro-settings input[type="number"] {
    width: 60px; padding: 8px; background-color: var(--bg-dark); color: var(--text-light);
    border: 1px solid var(--border-color); border-radius: var(--border-radius-small); text-align: center;
}
.digital-clock { text-align: center; margin-top: 20px; font-size: 1em; color: var(--text-darker); }
#current-time-clock { color: var(--text-medium); }


/* --- Inventory / Trophy Case --- */
.inventory-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); /* Small items */
    gap: 20px; padding: 15px; background-color: rgba(0,0,0,0.1); border-radius: var(--border-radius-small);
    min-height: 150px; /* Ensure it has some height even when empty */
}
.inventory-item {
    background-color: var(--bg-element); border: 1px solid var(--border-color); border-radius: var(--border-radius-small);
    padding: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center;
    text-align: center; aspect-ratio: 1 / 1; /* Make items square */
    box-shadow: var(--box-shadow-subtle); transition: transform var(--transition-main);
}
.inventory-item:hover { transform: scale(1.05); border-color: var(--color-gold); }
.inventory-item img { max-width: 60%; max-height: 60%; object-fit: contain; margin-bottom: 8px; filter: drop-shadow(0 0 3px rgba(0,0,0,0.5)); }
.inventory-item p { font-size: 0.8em; color: var(--text-medium); margin-bottom: 0; line-height: 1.2; }


/* --- Achievements Section --- */
.achievements-log ul { list-style: none; padding: 0; }
.achievements-log li {
    background-color: var(--bg-element); padding: 15px 20px; margin-bottom: 12px;
    border-radius: var(--border-radius-small); border-left: 5px solid var(--text-darker);
    font-size: clamp(0.95em, 2.4vw, 1.05em); color: var(--text-medium);
    transition: all var(--transition-main); display: flex; align-items: center; gap: 12px;
}
.achievements-log li.unlocked {
    color: var(--text-light); border-left-color: var(--color-gold);
    background-color: color-mix(in srgb, var(--bg-element) 85%, var(--color-gold) 8%);
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
.achievements-log li .icon-tiny {
    width: clamp(20px, 3.8vw, 28px); height: clamp(20px, 3.8vw, 28px);
    filter: grayscale(70%) opacity(0.6); transition: filter 0.3s ease;
    border-radius: 4px; /* If icons are square, slightly round them */
    padding: 2px; /* If icon needs a little space */
    background-color: rgba(0,0,0,0.1); /* Subtle background for icon placeholder */
}
.achievements-log li.unlocked .icon-tiny { filter: none; background-color: transparent; }
.achievements-log li .ach-desc { font-size: 0.9em; opacity: 0.85; color: var(--text-darker); }
.achievements-log li.unlocked .ach-desc { color: var(--text-medium); }


/* --- Customization (Themes) --- (Largely same, subtle enhancements) */
.theme-options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; }
.theme-card { /* Style as per previous enhanced version, ensure consistency */
    background-color: var(--bg-element); border: 2px solid var(--border-color); padding: 20px;
    border-radius: var(--border-radius-main); text-align: center; transition: all var(--transition-main);
    cursor: pointer; position: relative; overflow: hidden;
}
.theme-card:not(.locked-theme)::before { /* Shimmer from previous version */
    content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
    background: linear-gradient(to right, transparent 0%, rgba(255,255,255,0.15) 50%, transparent 100%);
    transform: skewX(-25deg); transition: left 0.6s ease; z-index: 1;
}
.theme-card:not(.locked-theme):hover::before { left: 150%; }
.theme-card:not(.locked-theme):hover { border-color: var(--color-yellow-bright); box-shadow: 0 0 20px color-mix(in srgb, var(--color-yellow-bright) 28%, transparent), var(--box-shadow-subtle); transform: translateY(-5px); }
.theme-card.current-theme { border-color: var(--color-gold); box-shadow: 0 0 25px color-mix(in srgb, var(--color-gold) 45%, transparent), var(--box-shadow-strong); }
.theme-preview { /* Style as per previous enhanced version */
    width: 100%; height: 130px; border-radius: var(--border-radius-small); margin-bottom: 18px;
    display: flex; align-items: center; justify-content: center; font-size: 0.9em;
    color: var(--text-light); text-shadow: 1px 1px 2px #000; border: 2px solid var(--border-color);
    position: relative; z-index: 0; background-size: cover; background-position: center;
}
.theme-card p { font-family: var(--font-title); color: var(--text-light); font-size: clamp(1.1em, 3.2vw, 1.25em); margin-bottom: 10px; position: relative; z-index: 0;}
.theme-status { font-size: clamp(0.85em, 2.1vw, 0.95em); color: var(--text-darker); position: relative; z-index: 0;}
.locked-theme { opacity: 0.75; cursor: not-allowed; border-color: #4a3d30 !important; }
.locked-theme:hover { box-shadow: var(--box-shadow-subtle) !important; transform: none !important; }
.locked-theme .theme-preview { filter: grayscale(85%) brightness(0.75); }
.locked-theme .theme-status { color: var(--color-red-accent); }

/* --- Footer --- */
.main-footer {
    text-align: center; padding: 35px 20px; margin-top: 45px;
    background-color: var(--bg-header); color: var(--text-medium);
    font-size: clamp(0.9em, 2.3vw, 1em); border-top: 3px solid var(--color-gold-darker);
    transition: background-color 0.5s ease, border-color 0.5s ease;
}
.social-links { margin-bottom: 15px; }
.social-links a { margin: 0 10px; display: inline-block; }
.social-links img { width: 28px; height: 28px; opacity: 0.7; transition: opacity var(--transition-main), transform var(--transition-main); }
.social-links a:hover img { opacity: 1; transform: scale(1.15); }
.main-footer .reset-button { display: block; margin: 25px auto 0; max-width: 240px; }

/* --- Modals --- */
.modal {
    display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%;
    overflow: auto; background-color: rgba(10,8,7,0.7); /* Slightly lighter, more brown backdrop */
    -webkit-backdrop-filter: var(--backdrop-filter-glass); backdrop-filter: var(--backdrop-filter-glass);
    animation: fadeIn 0.35s ease-out;
}
.modal-content {
    background-color: var(--bg-modal); color: var(--text-light);
    margin: 7% auto; padding: clamp(30px, 5.5vw, 45px);
    border: var(--border-panel); border-radius: var(--border-radius-main);
    width: 90%; max-width: 600px; box-shadow: var(--box-shadow-strong), var(--box-shadow-inset);
    position: relative; animation: slideInModal 0.45s ease-out;
}
.modal-content::before { /* Inner border, ensure it uses modal's radius */
    content: ''; position: absolute; top: 7px; left: 7px; right: 7px; bottom: 7px;
    border: var(--border-panel-inner); border-radius: calc(var(--border-radius-main) - 5px); /* Adjusted for thicker main border */
    pointer-events: none; opacity: 0.6;
}
.close-btn {
    color: var(--text-medium); position: absolute; top: 18px; right: 22px;
    font-size: clamp(26px, 5.5vw, 32px); font-weight: bold; transition: all var(--transition-main);
    line-height: 1; padding: 6px; z-index: 10; /* Above pseudo elements */
}
.close-btn:hover, .close-btn:focus { color: var(--color-red-primary); transform: scale(1.25) rotate(180deg); text-decoration: none; cursor: pointer; }
.modal-content label { display: block; margin-top: 20px; margin-bottom: 8px; font-family: var(--font-content); color: var(--text-medium); font-weight: bold; }
.modal-content input[type="text"], .modal-content input[type="number"], .modal-content textarea {
    width: 100%; padding: 14px 18px; margin-bottom: 20px; border: 1px solid var(--border-color);
    border-radius: var(--border-radius-small); background-color: var(--bg-dark); color: var(--text-light);
    font-family: var(--font-content); font-size: clamp(0.95em, 2.5vw, 1.05em); transition: border-color 0.3s, box-shadow 0.3s;
}
.modal-content input[type="text"]:focus, .modal-content input[type="number"]:focus, .modal-content textarea:focus {
    outline: none; border-color: var(--color-gold); box-shadow: 0 0 10px color-mix(in srgb, var(--color-gold) 25%, transparent);
}
.modal-content textarea { min-height: 100px; resize: vertical; }
.checkbox-label { display: flex; align-items: center; gap: 10px; color: var(--text-medium); margin-top: 18px; cursor: pointer; font-weight: normal; }
.modal-content input[type="checkbox"] { width: auto; accent-color: var(--color-gold); transform: scale(1.3); margin-right: 5px; }
.form-hint { font-size: 0.85em; color: var(--text-darker); margin-top: -10px; margin-bottom: 15px; }
.modal-content .action-button { display: block; width: 100%; margin-top: 28px; }

/* XP Bar & Level Display (already partially defined, consolidating) */
.level-area { text-align: center; margin-bottom: 35px; }
.level-display-main-wrapper { display: inline-block; position: relative; margin-bottom: 25px; }
.level-display-main {
    font-family: var(--font-title); font-size: clamp(3em, 8.5vw, 4.5em); color: var(--color-gold);
    display: inline-flex; align-items: center; justify-content: center;
    background-color: var(--color-red-accent); padding: 10px clamp(25px, 5.5vw, 40px);
    border-radius: 60px; border: 5px outset var(--color-gold);
    box-shadow: var(--box-shadow-strong), 0 0 25px color-mix(in srgb, var(--color-gold) 35%, transparent);
    text-shadow: 2px 2px 5px rgba(0,0,0,0.6);
}
.xp-bar-container {
    width: 100%; max-width: 650px; background-color: var(--xp-bar-container-bg);
    border: 4px solid var(--border-accent); border-radius: 35px; height: 38px;
    margin: 0 auto 18px; position: relative; box-shadow: var(--box-shadow-inset), 0 2px 3px rgba(0,0,0,0.35);
    overflow: hidden;
}
.xp-bar {
    background: var(--xp-bar-bg); height: 100%; border-radius: 30px;
    transition: width 0.7s cubic-bezier(0.65, 0, 0.35, 1); /* Smooth professional transition */
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 0 15px color-mix(in srgb, var(--color-yellow-bright) 55%, transparent), inset 0 1.5px 1.5px rgba(255,255,255,0.25);
}
.xp-text { color: var(--text-on-gold); font-weight: bold; font-size: clamp(0.85em, 2.1vw, 1em); text-shadow: 1px 1px 2px rgba(0,0,0,0.35); }
.level-up-message { color: var(--color-gold); font-family: var(--font-title); font-size: clamp(1.3em, 3.2vw, 1.7em); margin-top: 18px; text-shadow: 1px 1px 4px #000; animation: pulseGlow 2.5s infinite ease-in-out; }

/* Empty State Styling */
.empty-state { text-align: center; color: var(--text-darker); font-style: italic; padding: 35px; font-size: clamp(1.05em, 2.9vw, 1.15em); opacity: 0.7; }

/* --- Responsive Adjustments --- */
@media (max-width: 992px) { /* Larger tablets */
    .character-sheet-grid { grid-template-columns: 1fr; } /* Stack character sheet panels earlier */
}

@media (max-width: 768px) {
    body { padding-top: calc(var(--header-height) + 55px); } /* Nav might wrap, give a bit more space */
    .main-header { height: auto; }
    .header-content { flex-wrap: wrap; padding: 12px 18px; height: var(--header-height); }
    .site-title { order: 1; flex-basis: 55%; font-size: 1.7em; }
    .player-stats-header { order: 3; flex-basis: 100%; justify-content: center; margin-top: 8px; gap: 12px; font-size: 0.9em; }
    .nav-toggle-btn { display: flex; order: 2; margin-left: auto; }
    .top-nav {
        display: none; flex-direction: column; width: 100%;
        background-color: var(--bg-header); position: absolute;
        top: var(--header-height); left: 0; padding: 12px 0;
        box-shadow: 0 5px 10px rgba(0,0,0,0.45); z-index: 999;
    }
    .top-nav.active { display: flex; animation: slideDownNav 0.35s ease-out; }
    .nav-link { margin: 10px 0; width: 90%; text-align: center; padding: 14px; border-bottom: 1px solid var(--border-color); font-size: 1.15em; }
    .content-section.panel-style { padding: 25px 18px; }
    .quest-item { flex-direction: column; align-items: stretch; }
    .quest-item .action-button { width: 100%; margin-top: 18px; }
    .modal-content { margin: 8% auto; width: 92%; padding: 25px; }
}

@media (max-width: 480px) {
    body { padding-top: calc(var(--header-height) + 50px); }
    .header-content { padding: 10px 12px; }
    .site-title { font-size: 1.4em; gap: 8px; }
    .site-logo-icon { height: 24px; }
    .player-stats-header { font-size: 0.8em; margin-top: 5px; }
    .stat-item { padding: 5px 10px; } .stat-icon { width: 16px; height: 16px; }
    .sound-toggle-btn { padding: 6px; } .sound-toggle-btn .button-icon { width: 18px; height: 18px; }
    .section-title.ornate-title { font-size: 1.5em; margin-bottom: 30px; }
    .section-title.ornate-title span { padding: 0 12px; }
    .subsection-title { font-size: 1.2em; }
    .action-button { padding: 12px 18px; font-size: 1em; }
    .habit-grid, .inventory-grid { grid-template-columns: 1fr; gap: 18px; }
    .level-display-main { font-size: 2.6em; padding: 8px 22px; }
    .xp-bar-container { height: 32px; } .xp-text { font-size: 0.85em; }
    .modal-content { width: 95%; margin: 5% auto; padding: 20px; max-height: 90vh; }
    .pomodoro-controls { flex-direction: column; gap: 10px; }
    .pomodoro-controls .action-button { width: 100%; }
    .pomodoro-settings { flex-direction: column; gap: 8px; }
    .pomodoro-settings input[type="number"] { width: 80px; }
}